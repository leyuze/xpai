---
title: Redis面试总结
date: 2021-06-14 22:59:24
permalink: /pages/a26133/
categories:
  - 更多
  - 面试经验
  - 后端面经
tags:
  - 
---
## redis为什么查询快，效率高？

### 100000+QPS（每秒内查询次数）

1、完全基于内存，绝大部分请求是纯粹的内存操作，执行效率高
2、数据结构简单，对数据操作也简单
3、采用单线程，单线程也能处理高并发请求，想多核也可启动多实例
4、使用多路I/O复用模型，非阻塞IO

### 多路I/O复用模型

Redis采用的I/O多路复用函数：epoll/kqueue/evport/select

1、因地制宜
2、优先选择时间复杂度为O(1)的I/O多路复用函数作为底层实现
3、以时间复杂度为O(n)的select作为保底
4、基于react设计模式监听I/O事件

hyperLogLog ： 用于计数    Geo：用于储存地理位置信息

```
scan cursor [MATCH pattern][COUNT count]
```

1、基于游标的迭代器，需要基于上一次的游标延续之前的迭代过程
2、以0作为游标开始一次新的迭代，直到命令返回游标0完成一次遍历
3、不保证每次执行都返回某个给定数量的元素，支持模糊查询
4、一次返回的数量不可控，只能是大概率符合count参数

## redis如何实现分布式锁？

```
SET key value [EX seconds][PX milliseconds][NX|XX]
```

1、EX second:设置键的过期时间为second秒
2、PX millisecond：设置键的过期时间为millisecond毫秒
3、NX：只在键不存在时，才对键进行设置操作
4、XX：只在键已经存在时，才对键进行设置操作
5、SET 操作成功完成时，返回OK，否则返回nil

## redis做异步队列？

BLPOP key [key...] timeout：阻塞直到队列有消息或者超时

1、缺点：

只能提供一个消费者消费

pub(publish)/sub（subscribe）:主题订阅者模式

1、发送者（pub）发送消息，订阅者（sub）接收消息
2、订阅者可以订阅任意数量的频道
缺点：

消息的发布是无状态的，无法保证可达

## redis持久化

### 1、RDB（快照）持久化

保存某个时间点的全量数据快照

①save：阻塞redis的服务器进程，直到RDB文件被创建完毕
②BGSAVE：Fork出一个子进程来创建RDB文件，不阻塞服务器进程

根据redis.conf配置里的SAVE m n 定时触发（用的是BGSAVE）

主从复制时，主节点自动触发
执行Debug Reload
执行Shutdown且没有开启AOF持久化

缺点：

①内存数据的全量同步，数据量大会由于I/O而严重影响性能
②可能会因为Redis挂掉而丢失当前至最新一次快照期间数据

### 2、AOF（Append-Only-File）持久化

保存写状态

①记录下除了查询以外的所有表更数据库状态的指令
②以append的形式追加保存到AOF文件中（增量）

日志重写解决AOP文件大小不断增大的问题，原理如下

1、调用fork()，创建一个子进程
2、子进程把新的AOF写到一个临时文件里，不依赖原来的AOF文件
3、主进程持续将新的变动同时写到内存和原来的AOF里
4、主进程获取子进程重写AOF的完成信号，往新AOF同步增量变动
5、使用新的AOF文件替换旧的AOF文件

### RDB-AOF混合持久化方式

1、BGSAVE做镜像全量持久化，AOF做增量持久化

#### 使用Pipeline的好处

1、Pipeline和Linux的管道类似
2、redis基于请求/响应模式，单个请求处理需要一一应答
3、Pipeline批量执行指令，节省多次IO往返的时间
4、有顺序依赖的指令建议分批发送

## redis的同步机制

### 主从同步原理

1、全同步过程

①Salve发送sync命令到Master
②Master启动一个后台进程，将Redis中的数据快照保存到文件中
③Master将保存数据快照期间接收到的写命令缓存起来
④Master完成写文件操作后，将该文件发送给Salve
⑤使用新的AOF文件替换掉旧的AOF文件
⑥Master将这期间收集的增量写命令发送给Salve端

2、增量同步过程

①Master接收到用户的操作指令，判断是否需要传播到Slave
②将操作记录追加到AOF文件
③将操作传播到其他Slave ：1、对齐主从库2、往响应缓存写入指令
④将缓存中的数据发送给Slave

## redis sentinel 解决主从同步Master宕机后的主从切换问题？

1、监控：检查主从服务器是否运行正常
2、提醒：通过API向管理员或者其他应用程序发送故障通知
3、自动故障迁移：主从切换

流言协议Gossip：在杂乱无章中寻求一致

1、每个节点都随机地与对方通信，最终所有节点的状态达成一致
2、种子节点定期随机向其他节点发送节点列表以及需要传播的消息
3、不保证信息一定会传递给所有节点，但是最终会趋于一致